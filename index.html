<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>قصة خبزة | Lastoria Bread</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800;900&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ==================================================================
           1. MAIN WEBSITE CSS
           ================================================================== */
        :root {
            --primary-color: #B28451; 
            --primary-dark: #8E6A41;  
            --bg-cream-light: #F8F5EF;
            --secondary-color: #4A4A4A; 
            --bg-dark: #333333;       
            --white: #ffffff;
            --light-grey: #e9e9e9; 
            --app-ninja: #5A2D82;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-cream-light); 
            color: var(--secondary-color);
            line-height: 1.8;
            direction: rtl; 
            text-align: right; 
            scroll-behavior: smooth;
        }

        .container { width: 90%; max-width: 1200px; margin: 0 auto; padding: 20px 0; }

        h1, h2, h3, h4 { font-family: 'Amiri', serif; font-weight: 700; margin-bottom: 25px; color: var(--secondary-color); }
        h1 { font-size: 3.5rem; }
        h2 { text-align: center; font-size: 2.8rem; position: relative; margin-bottom: 40px; padding-bottom: 15px; }
        h2::after { content: ''; display: block; width: 100px; height: 5px; background: var(--primary-color); margin: 15px auto 0; border-radius: 3px; }
        h2 .section-icon { font-size: 2.5rem; margin-left: 10px; color: var(--primary-color); vertical-align: -5px; transition: transform 0.3s ease; }

        section { padding: 80px 0; }
        .text-center { text-align: center; }

        /* NAVBAR */
        .navbar {
            background: rgba(255, 255, 255, 0.95); padding: 15px 0; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.08); position: fixed; top: 0; left: 0; width: 100%; z-index: 1000;
            transition: background-color 0.3s ease, padding 0.3s ease; 
        }
        .navbar.scrolled { background-color: var(--primary-color); box-shadow: 0 4px 10px rgba(0,0,0,0.2); padding: 10px 0; }
        .navbar.scrolled .nav-links a { color: var(--white); }
        .navbar .container { display: flex; justify-content: space-between; align-items: center; padding-top: 0; padding-bottom: 0; }

        .logo { font-family: 'Amiri', serif; font-size: 2.2rem; font-weight: 900; color: var(--primary-color); text-decoration: none; transition: color 0.3s ease; }
        .logo i { margin-left: 10px; transition: transform 0.4s ease; }
        .logo:hover i { transform: rotate(15deg); }
        .navbar.scrolled .logo { color: var(--white); }

        .nav-links { list-style: none; display: flex; align-items: center; }
        .nav-links li { margin-left: 15px; }
        .nav-links a {
            text-decoration: none; color: var(--secondary-color); font-weight: 700; font-size: 1.1rem;
            transition: all 0.3s ease; position: relative; padding: 8px 15px; 
            border: 2px solid transparent; border-radius: 50px; display: flex; align-items: center; 
        }
        .nav-links a:hover { color: var(--primary-color); background-color: rgba(178, 132, 81, 0.1); border-color: var(--primary-color); }

        /* HERO SECTION */
        .hero {
            background: var(--primary-color); color: var(--white); text-align: center;
            padding: 150px 20px 80px 20px; display: flex; align-items: center; justify-content: center;
            min-height: 80vh; position: relative;
        }
        .hero-content { max-width: 900px; }
        .hero h1 { font-size: 4.5rem; margin-bottom: 20px; color: var(--white); font-weight: 900; line-height: 1.2; text-shadow: 0 3px 10px rgba(0,0,0,0.2); }
        .hero p { font-size: 1.5rem; margin-bottom: 30px; max-width: 600px; margin-left: auto; margin-right: auto; font-family: 'Cairo', sans-serif; font-weight: 400; }

        .hero-btn-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-bottom: 30px; }

        .unified-btn {
            background: var(--white); 
            color: var(--primary-dark); 
            padding: 15px 35px; 
            text-decoration: none;
            border-radius: 50px; 
            font-weight: 800; 
            font-size: 1.2rem; 
            transition: all 0.3s ease; 
            display: inline-block; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.2); 
            border: 2px solid var(--white); 
            cursor: pointer;
        }
        .unified-btn:hover { 
            background: var(--bg-cream-light); 
            color: var(--primary-color); 
            transform: translateY(-5px); 
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .quality-steps { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 30px; margin-bottom: 30px; }
        .step-card { text-align: center; padding: 15px; border-radius: 12px; background: rgba(255, 255, 255, 0.1); transition: background-color 0.3s ease; }
        .step-card:hover { background: rgba(255, 255, 255, 0.2); transform: translateY(-5px); }
        .step-card i { font-size: 2.5rem; color: var(--white); margin-bottom: 10px; }
        .step-card h3 { font-size: 1.3rem; color: var(--white); margin-bottom: 5px; }
        .step-card p { color: var(--bg-light); font-size: 0.8rem; line-height: 1.5; }

        /* PRODUCTS */
        #products { background: var(--bg-cream-light); padding-bottom: 40px; }
        
        .price-disclaimer {
            background-color: #fff3cd; border: 1px solid #ffeeba; color: #856404;
            padding: 20px; margin: 20px auto; max-width: 850px; text-align: center;
            border-radius: 10px; font-weight: bold; font-size: 1rem; line-height: 1.8;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .product-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; margin-top: 40px; }
        .product-card {
            background: var(--white); border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.08); 
            overflow: hidden; transition: transform 0.3s ease;
            border: 3px solid var(--light-grey); opacity: 0; transform: translateY(20px); cursor: pointer; display: flex; flex-direction: column;
        }
        .product-card.reveal { opacity: 1; transform: translateY(0); }
        .product-card:hover { transform: translateY(-8px); border-color: var(--primary-color); }
        .product-card img { width: 100%; height: 250px; object-fit: contain; transition: transform 0.4s ease; }
        .product-card:hover img { transform: scale(1.05); }

        .product-info { padding: 25px; text-align: right; flex-grow: 1; display: flex; flex-direction: column; }
        .product-info h3 { font-size: 1.6rem; margin-bottom: 10px; color: var(--primary-color); font-family: 'Amiri', serif; }
        .product-price { font-size: 1.8rem; font-weight: 900; color: var(--primary-dark); direction: ltr; text-align: left; margin-top: auto; }
        .product-weight { font-size: 0.9rem; color: #888; margin-bottom: 10px; }
        
        .product-order-options { display: grid; grid-template-columns: repeat(4, 1fr); padding: 10px 5px; background-color: #fcfcfc; border-top: 1px solid var(--light-grey); gap: 5px; }
        .app-link {
            display: flex; flex-direction: column; align-items: center; justify-content: center; text-decoration: none;
            transition: all 0.3s ease; padding: 5px 0; border-radius: 8px; position: relative; 
            border: none; background: transparent; font-family: 'Cairo', sans-serif; cursor: pointer;
        }
        .app-link img { height: 22px; width: auto; object-fit: contain; margin-bottom: 3px; }
        .app-link i { font-size: 1.3rem; margin-bottom: 3px; }
        .app-link span { font-size: 0.7rem; font-weight: 700; }
        .app-link:hover { transform: scale(1.1); background-color: rgba(0,0,0,0.05); }
        .app-link.ninja { color: var(--app-ninja); }
        .app-link.soon { color: #aaa; pointer-events: none; filter: grayscale(80%); opacity: 0.7; }
        .app-link.soon span { display: none; }
        .app-link.soon::after {
            content: 'قريباً'; position: absolute; top: 110%; left: 50%; transform: translateX(-50%);
            background: var(--bg-dark); color: white; padding: 2px 5px; border-radius: 3px;
            font-size: 0.7rem; opacity: 0; transition: opacity 0.3s; white-space: nowrap; font-family: 'Cairo', sans-serif; z-index: 10;
        }
        .app-link.soon:hover::after { opacity: 1; }

        /* FIXED DELIVERY APPS SECTION */
        #delivery { background: var(--bg-cream-dark); padding: 60px 0; }
        .delivery-apps { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            flex-wrap: wrap; 
            gap: 20px; 
            margin-top: 30px; 
        }
        .app-logo-card {
            background: var(--white); 
            border-radius: 15px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            padding: 20px 30px; 
            display: flex; 
            flex-direction: column;
            align-items: center; 
            justify-content: center;
            gap: 10px; 
            transition: all 0.3s ease;
            width: 180px;
            text-decoration: none; 
            border: 2px solid transparent; 
        }
        .app-logo-card:hover { transform: translateY(-5px); border-color: var(--primary-color); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .app-logo-card img { height: 40px; width: auto; object-fit: contain; }
        .app-logo-card span { font-size: 1.1rem; font-weight: 700; color: var(--secondary-color); margin-top: 5px;}
        .app-logo-card.soon { opacity: 0.6; filter: grayscale(90%); pointer-events: none; border: 1px dashed #ccc; }

        .fade-in-on-scroll { opacity: 0; transform: translateY(20px); transition: opacity 0.6s ease-out, transform 0.6s ease-out; }
        .fade-in-on-scroll.reveal { opacity: 1; transform: translateY(0); }

        #back-to-top {
            position: fixed; bottom: 30px; right: 30px; background-color: var(--primary-color); color: var(--white);
            width: 50px; height: 50px; border-radius: 50%; text-align: center; line-height: 50px; font-size: 1.5rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease; 
            opacity: 0; visibility: hidden; z-index: 999; cursor: pointer;
        }
        #back-to-top.show { opacity: 1; visibility: visible; }
        #back-to-top:hover { background-color: var(--primary-dark); transform: scale(1.1); }
        
        /* PARTNER MODAL */
        .supp-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden; z-index: 3000; transition: 0.3s;
        }
        .supp-modal.active { opacity: 1; visibility: visible; }
        .supp-card {
            background: white; padding: 40px; border-radius: 20px; width: 90%; max-width: 500px; text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3); transform: scale(0.9); transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .supp-modal.active .supp-card { transform: scale(1); }
        .supp-icon { font-size: 3rem; color: var(--primary-color); margin-bottom: 20px; }
        .supp-title { font-family: 'Amiri', serif; font-size: 2rem; color: var(--secondary-color); margin-bottom: 10px; }
        .supp-text { margin-bottom: 25px; color: #666; font-size: 1.1rem; }
        .supp-info-box { background: var(--bg-cream-light); padding: 15px; border-radius: 10px; margin-bottom: 10px; text-align: right; }
        .supp-info-label { font-weight: bold; color: var(--primary-dark); display: block; font-size: 0.9rem; }
        .supp-info-val { font-family: sans-serif; font-size: 1.2rem; color: #333; direction: ltr; }
        .supp-close-btn { background: var(--secondary-color); color: white; border: none; padding: 10px 30px; border-radius: 30px; margin-top: 20px; cursor: pointer; font-weight: bold; }
        .supp-close-btn:hover { background: #333; }

        @media (max-width: 768px) {
            .navbar .container { flex-direction: column; padding: 10px 0; }
            .logo { font-size: 1.8rem; margin-bottom: 15px; }
            .nav-links { flex-wrap: wrap; justify-content: center; gap: 8px; margin-top: 0; width: 100%; }
            .nav-links li { margin: 0; flex-grow: 1; }
            .nav-links a { padding: 8px 12px; font-size: 0.9rem; text-align: center; display: block; border: 1px solid var(--light-grey); border-radius: 50px; }
            .hero { padding: 240px 15px 50px 15px; min-height: 60vh; }
            .hero h1 { font-size: 3rem; }
            .hero p { font-size: 1.2rem; }
            .quality-steps, .product-grid { grid-template-columns: 1fr; }
            .unified-btn { width: 100%; margin: 5px 0; }
            .delivery-apps { flex-direction: column; width: 100%; }
            .app-logo-card { width: 100%; flex-direction: row; justify-content: flex-start; gap: 20px; }
        }

        /* ==================================================================
           2. BUSINESS PORTAL CSS
           ================================================================== */
        #portal-container, #admin-view {
            display: none; 
            background-color: #FFF8F0;
            min-height: 100vh;
            color: #5D4037;
            text-align: right;
            direction: rtl;
        }

        #portal-container.active-view, #admin-view.active-view { display: block; }

        #portal-container {
            --p-primary: #C19A6B;
            --p-primary-dark: #8D6E48;
            --p-accent: #D4A373;
            --p-bg: #FFF8F0;
            --p-text: #5D4037;
        }

        #portal-container .p-header, #admin-view .p-header {
            position: sticky; top: 0; z-index: 1100;
            background: rgba(255, 248, 240, 0.9);
            backdrop-filter: blur(12px);
            padding: 15px 0;
            border-bottom: 1px solid rgba(193, 154, 107, 0.2);
        }
        .p-container { width: 90%; max-width: 1200px; margin: 0 auto; }
        .p-nav-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        
        .p-btn {
            background: white; border: 1px solid #EADDCD;
            color: var(--p-primary-dark); padding: 5px 15px; border-radius: 20px;
            cursor: pointer; font-family: 'Cairo'; font-weight: bold;
        }
        .p-btn:hover { background: var(--p-primary); color: white; }

        #portal-container .p-search-wrap { position: relative; max-width: 600px; margin: 0 auto; }
        #portal-container .p-search-inp {
            width: 100%; padding: 12px 20px; border-radius: 50px; border: 2px solid transparent;
            background: white; font-family: 'Cairo'; outline: none;
            box-shadow: 0 4px 15px rgba(193, 154, 107, 0.1);
        }
        #portal-container .p-search-inp:focus { border-color: var(--p-primary); }
        
        #portal-container .p-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; padding-top: 25px; padding-bottom: 100px; }
        
        #portal-container .p-card {
            background: white; border-radius: 20px; overflow: hidden;
            box-shadow: 0 5px 15px rgba(193, 154, 107, 0.15);
            transition: 0.3s; display: flex; flex-direction: column;
        }
        #portal-container .p-card.p-active { border: 2px solid var(--p-primary); background: #FFFCF9; }
        #portal-container .p-img-box { height: 130px; padding: 10px; display: flex; justify-content: center; align-items: center; background: radial-gradient(circle, #fff 40%, #fdfdfd 100%); }
        #portal-container .p-img-box img { max-width: 100%; max-height: 100%; object-fit: contain; }
        #portal-container .p-details { padding: 10px; text-align: center; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
        #portal-container .p-title { font-size: 0.9rem; font-weight: 700; margin-bottom: 10px; }
        
        #portal-container .p-qty-box {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 8px;
            text-align: center;
            font-family: 'Cairo';
            font-weight: bold;
            font-size: 1rem;
            color: var(--p-text);
            outline: none;
            transition: 0.3s;
        }
        #portal-container .p-qty-box:focus { border-color: var(--p-primary); background: #fffcf5; }
        #portal-container .p-card.p-active .p-qty-box { background: #FDEEDC; border-color: var(--p-primary); }

        #portal-container .p-float-bar {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(150%);
            width: 90%; max-width: 500px; background: rgba(45,45,45,0.95);
            backdrop-filter: blur(10px); color: white; border-radius: 50px;
            padding: 10px 20px; display: flex; justify-content: space-between; align-items: center;
            transition: 0.4s; z-index: 1200;
        }
        #portal-container .p-float-bar.visible { transform: translateX(-50%) translateY(0); }
        #portal-container .p-checkout-btn { background: var(--p-primary); color: white; border: none; padding: 8px 20px; border-radius: 30px; font-weight: bold; cursor: pointer; }

        #portal-container .p-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden; z-index: 2000; transition: 0.3s;
        }
        #portal-container .p-modal.active { opacity: 1; visibility: visible; }
        #portal-container .p-modal-card { background: white; padding: 25px; border-radius: 20px; width: 90%; max-width: 400px; }
        #portal-container .p-input { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 10px; font-family: 'Cairo'; display: block; }
        #portal-container .p-wa-btn { width: 100%; padding: 12px; background: #25D366; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        #portal-container .p-send-btn { width: 100%; padding: 12px; background: var(--p-primary); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; }

        /* ==================================================================
           3. ADMIN PANEL STYLES
           ================================================================== */
        #admin-orders-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 25px; padding-top: 20px; padding-bottom: 100px;
        }
        
        .admin-card {
            background: white; 
            border: 2px solid #cbd5e0; 
            border-radius: 16px; 
            padding: 20px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); 
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            display: flex;
            flex-direction: column;
            border-right: 6px solid var(--primary-color);
            font-weight: 700; 
        }

        .admin-card:hover { 
            transform: translateY(-8px); 
            box-shadow: 0 15px 30px rgba(0,0,0,0.15); 
            border-color: var(--primary-color);
        }
        
        .admin-card-header {
            display: flex; justify-content: space-between; align-items: flex-start; 
            margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #f0f0f0;
        }

        .admin-info-row {
            display: flex; align-items: center; gap: 8px; margin-bottom: 5px; color: #333;
        }
        .admin-info-row i { color: var(--primary-color); width: 20px; text-align: center; }

        .admin-client { font-weight: 900; font-size: 1.2rem; color: #2c3e50; font-family: 'Cairo', sans-serif; }
        
        .admin-code-badge { 
            background: #2c3e50; color: white; padding: 4px 12px; 
            border-radius: 8px; font-size: 0.9rem; font-weight: 800; 
        }

        .admin-products-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            background: #fcfcfc;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #ddd;
        }
        .admin-products-table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
            font-size: 1rem;
            color: #333;
            font-weight: 700;
        }
        .admin-products-table tr:last-child td { border-bottom: none; }
        
        .admin-qty-badge { 
            background: var(--primary-color); color: white; 
            padding: 4px 12px; 
            border-radius: 6px; 
            display: inline-block;
            min-width: 30px;
            text-align: center;
            font-weight: 800; font-size: 0.95rem;
        }

        .admin-total-row {
            margin-top: 10px;
            background: #eee;
            padding: 8px;
            border-radius: 6px;
            text-align: center;
            font-weight: 900;
            color: #333;
            border: 1px dashed #ccc;
        }
        
        .admin-notes { 
            background: #fff8e1; color: #856404; padding: 12px; 
            border-radius: 8px; font-size: 0.95rem; margin-top: 15px; margin-bottom: 15px;
            display: flex; gap: 8px; align-items: flex-start;
            border: 1px solid #ffeeba;
            font-weight: 700;
        }
        
        .admin-footer { margin-top: auto; }
        
        .btn-invoice { 
            width: 100%;
            background-color: #27ae60; color: white; border: none; padding: 14px; 
            border-radius: 10px; cursor: pointer; font-weight: 800; font-family: 'Cairo'; font-size: 1rem;
            transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-invoice:hover { background-color: #219150; transform: scale(1.02); }

        .admin-search-box { 
            background: white; padding: 15px; border-radius: 50px; margin-bottom: 20px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: flex; gap: 10px; border: 1px solid #eee;
        }
        .admin-search-inp { width: 100%; border: none; padding: 5px 10px; outline: none; font-family: 'Cairo'; font-size: 1.1rem; font-weight: bold;}

        /* ARCHIVED FLOATING BUTTON */
        .fab-archive {
            position: fixed; bottom: 30px; left: 30px;
            background: #34495e; color: white; border: none;
            padding: 15px 25px; border-radius: 50px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            cursor: pointer; font-weight: bold; font-size: 1rem;
            display: flex; align-items: center; gap: 10px;
            z-index: 1500; transition: transform 0.2s;
        }
        .fab-archive:hover { transform: scale(1.05); background: #2c3e50; }

        .archive-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 2000;
            display: none; justify-content: center; align-items: center;
        }
        .archive-content {
            background: white; width: 90%; max-width: 800px; height: 80vh;
            border-radius: 20px; padding: 25px; overflow-y: auto; position: relative;
        }
        .close-archive {
            position: absolute; top: 15px; left: 20px;
            font-size: 1.5rem; cursor: pointer; color: #777;
        }
        .archive-status {
            color: #27ae60; font-weight: bold; text-align: center; margin-top: 10px;
            border: 1px solid #27ae60; padding: 5px; border-radius: 50px; font-size: 0.8rem;
        }

    </style>
</head>
<body>

    <div id="main-website-wrapper">

        <header class="navbar">
            <div class="container">
                <a href="#" class="logo"><i class="fas fa-bread-slice"></i> قصة خبزة</a>
                <nav>
                    <ul class="nav-links">
                        <li><a href="#products"><i class="fas fa-utensils"></i> منتجاتنا</a></li>
                        <li><a href="#delivery"><i class="fas fa-shipping-fast"></i> اطلب الآن</a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <main>
            <section class="hero" id="home"> <div class="hero-content">
                    <h1>أهلاً بكم في قصة خبزة</h1>
                    <p> حيث تتلاقى الأصالة مع الطعم الرفيع لتصنع لكم أشهى المخبوزات و <strong>ساندوتشات طازجة</strong> يومياً.</p>
                    
                    <div class="hero-btn-container">
                        <a href="#products" class="unified-btn"><i class="fas fa-arrow-down"></i> اكتشف المخبوزات</a>
                        
                        <button onclick="togglePortal(true)" class="unified-btn">
                            <i class="fas fa-briefcase"></i> بوابة الأعمال (طلب الجملة)
                        </button>
                        
                        <button onclick="openSupplierModal()" class="unified-btn">
                            <i class="fas fa-handshake"></i> كن شريكنا (للمنشآت)
                        </button>
                    </div>

                    <div class="quality-steps">
                        <div class="step-card"><i class="fas fa-leaf"></i><h3>مكونات طازجة</h3><p>ننتقي أجود المكونات الطبيعية 100% يومياً.</p></div>
                        <div class="step-card"><i class="fas fa-hand-sparkles"></i><h3>صناعة يدوية</h3><p>تُخبز وتُعد جميع منتجاتنا بعناية فائقة.</p></div>
                        <div class="step-card"><i class="fas fa-check-circle"></i><h3>ضمان الجودة</h3><p>تمر كل قطعة بفحص دقيق لضمان رضائكم.</p></div>
                    </div>
                </div>
            </section>

            <section id="products">
                <div class="container">
                    <h2><i class="section-icon fas fa-utensils"></i> مخبوزات وساندوتشات طازجة</h2>
                    
                    <div class="price-disclaimer">
                        <i class="fas fa-info-circle"></i> تنويه: الأسعار الظاهرة مخصصة لطلبات التوصيل عبر تطبيق نينجا.
                        <br>
                        تختلف أسعار البيع المباشر في المعرض، كما نوفر أسعاراً خاصة لطلبات الجملة (الشركات والمطاعم) عبر <a href="#" onclick="togglePortal(true); return false;" style="color:#856404; text-decoration:underline;">بوابة الأعمال</a>.
                    </div>

                    <div class="product-grid" id="publicProductGrid">
                        </div>
                </div>
            </section>

            <section id="delivery">
                <div class="container">
                    <h2><i class="section-icon fas fa-shipping-fast"></i> اطلب الآن عبر التطبيقات</h2>
                    <p class="text-center" style="font-size:1.1rem; margin-bottom: 40px; max-width: 700px; margin-left: auto; margin-right: auto;">
                        منتجاتنا متوفرة للطلب المباشر للأفراد عبر تطبيق نينجا.
                    </p>
                    <div class="delivery-apps">
                        <a href="https://ananinja.com/sa/ar/product/search?q=lastoria" target="_blank" class="app-logo-card app-ninja" id="main-ninja-link">
                            <img src="https://i.ibb.co/G4fMtQFc/Ninja-Logo-removebg-preview.png" alt="Ninja Logo">
                            <span>Ninja</span>
                        </a>
                        <div class="app-logo-card soon"><img src="https://i.ibb.co/0RCrz1tS/Hungerstation-logo-removebg-preview.png"><span>Hungerstation</span></div>
                        <div class="app-logo-card soon"><img src="https://i.ibb.co/qM4Mf662/Jahez-Logo-removebg-preview.png"><span>Jahez</span></div>
                    </div>
                </div>
            </section>

        </main>

        <div id="back-to-top" class="fas fa-arrow-up"></div>
        
        <div id="supplierModal" class="supp-modal">
            <div class="supp-card">
                <div class="supp-icon"><i class="fas fa-handshake"></i></div>
                <h3 class="supp-title">كن شريكنا في النجاح</h3>
                <p class="supp-text">هل ترغب في اعتمادنا كمورد رئيسي لمخبوزات منشأتك (مطعم، كافيه، أو فندق)؟ نسعد بتزويدكم بألذ المنتجات. تواصل معنا الآن:</p>
                
                <div class="supp-info-box">
                    <span class="supp-info-label">البريد الإلكتروني:</span>
                    <div class="supp-info-val">LastoriaBread@gmail.com</div>
                </div>
                
                <div class="supp-info-box">
                    <span class="supp-info-label">رقم الهاتف / واتساب:</span>
                    <div class="supp-info-val">+966500156840</div>
                </div>
                
                <button class="supp-close-btn" onclick="closeSupplierModal()">إغلاق النافذة</button>
            </div>
        </div>

    </div> 

    <div id="portal-container">
        <header class="p-header">
            <div class="p-container">
                <div class="p-nav-row">
                    <button class="p-btn" onclick="togglePortal(false)">
                        <i class="fas fa-arrow-right"></i> العودة للرئيسية
                    </button>
                    
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <span style="font-weight: bold; color: var(--p-text);">بوابة الأعمال (أسعار الجملة)</span>
                        
                        <button onclick="promptAdminLogin()" style="background:none; border:none; color:#ddd; cursor:pointer;" title="Admin">
                            <i class="fas fa-lock"></i>
                        </button>

                        <button id="pLangBtn" onclick="pToggleLang()" class="p-btn" style="padding: 2px 10px; font-size: 0.8rem;">English</button>
                    </div>
                </div>
                
                <div class="p-search-wrap">
                    <input type="text" id="pSearchInp" class="p-search-inp" placeholder="ابحث عن صنف...">
                </div>
            </div>
        </header>

        <main class="p-container">
            <div class="p-grid" id="pGrid"></div>
            
            <div id="pNoResults" style="display:none; text-align:center; padding: 60px 20px; color: #999;">
                <i class="fas fa-cookie-bite" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.3;"></i>
                <p>لا توجد منتجات مطابقة</p>
            </div>
        </main>

        <div class="p-float-bar" id="pFloatBar">
            <div>
                <span style="font-size: 0.75rem; opacity: 0.8;" id="txtTotalQty">إجمالي الكمية</span>
                <strong id="pTotalQty" style="font-size: 1.2rem; color: var(--p-accent);">0</strong>
            </div>
            <button class="p-checkout-btn" onclick="pOpenModal()">
                <span id="txtCheckout">متابعة الطلب</span> 
                <i class="fas fa-check"></i>
            </button>
        </div>

        <div class="p-modal" id="pModal">
            <div class="p-modal-card">
                <div style="text-align: right; margin-bottom: 10px;">
                    <i class="fas fa-times" onclick="pCloseModal()" style="cursor:pointer; color:#999; font-size:1.2rem;"></i>
                </div>
                <h3 style="text-align: center; margin-bottom: 20px; color: var(--p-text);" id="txtModalTitle">بيانات طلب التوريد</h3>
                <label style="font-size: 0.9rem; font-weight: bold;">اسم المنشأة <span style="color:red">*</span></label>
                <input type="text" id="pClientName" class="p-input">
                <label style="font-size: 0.9rem; font-weight: bold;">كود العميل <span style="color:red">*</span></label>
                <input type="text" id="pClientCode" class="p-input">
                <label style="font-size: 0.9rem; font-weight: bold;">ملاحظات</label>
                <textarea id="pNotes" class="p-input" rows="2"></textarea>
                <button class="p-send-btn" onclick="pSubmitOrder()">
                    <span id="txtSendBtn">إرسال الطلب</span>
                </button>
            </div>
        </div>
    </div>

    <div id="admin-view">
        <header class="p-header">
            <div class="p-container">
                <div class="p-nav-row">
                    <button class="p-btn" onclick="toggleAdminView(false)">
                        <i class="fas fa-sign-out-alt"></i> خروج
                    </button>
                    <div style="font-weight: bold; color: var(--p-text);">
                        <i class="fas fa-user-shield"></i> لوحة تحكم الطلبات
                    </div>
                    <button class="p-btn" onclick="fetchOrders()">
                        <i class="fas fa-sync"></i> تحديث
                    </button>
                </div>
            </div>
        </header>
        <main class="p-container">
            <div class="admin-search-box">
                <input type="text" id="adminSearch" class="admin-search-inp" placeholder="ابحث باسم العميل أو الكود..." onkeyup="filterOrders()">
                <i class="fas fa-search" style="color:var(--primary-color); align-self:center;"></i>
            </div>

            <h3 style="color: var(--primary-dark); margin-bottom: 20px;"><i class="fas fa-inbox"></i> الطلبات الجديدة</h3>
            <div id="admin-orders-grid">
                <div style="text-align:center; padding:50px;">جاري تحميل الطلبات...</div>
            </div>
        </main>

        <button class="fab-archive" onclick="openArchiveModal()">
            <i class="fas fa-box-archive"></i> أرشيف الفواتير
        </button>

        <div id="admin-archive-modal" class="archive-modal">
            <div class="archive-content">
                <span class="close-archive" onclick="closeArchiveModal()">&times;</span>
                <h2 style="font-size:1.8rem; margin-bottom:20px; color:#34495e;">الأرشيف (تم إصدار الفاتورة)</h2>
                <div id="admin-archive-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                    </div>
            </div>
        </div>
    </div>


    <script>
        // ==================================================================
        // CONFIGURATION
        // ==================================================================
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxJ5S7BDLs5DylAc2HZj9tLncO4BA1VmBcAMY8a8c4lhcRj0xFZYMtgBwDZ3sAzCvWL/exec";
        
        const allProducts = [
            { id: 1, nameAr: "أصابع قرفة بالسكر", nameEn: "Cinnamon Sugar Fingers", weight: "مقرمشة ولذيذة", price: "9.95 ر.س", link: "https://ananinja.com/sa/ar/product/lastoria-cinnamon-sugar-fingers-shabura-19-19368122", img: "https://i.ibb.co/7xzsRjhj/removebg-preview.png" },
            { id: 2, nameAr: "بريتزل دجاج البيستو", nameEn: "Pesto Chicken Pretzel", weight: "بريتزل شهي", price: "12.95 ر.س", link: "https://ananinja.com/sa/ar/product/lastoria-chicken-in-pretzel-bread-19-19368121", img: "https://i.ibb.co/MxryJ7XJ/removebg-preview.png" },
            { id: 3, nameAr: "ثلاث أجبان كلوب ساندوتش", nameEn: "Three Cheese Club Sandwich", weight: "160 جم", price: "9.95 ر.س", link: "https://ananinja.com/sa/ar/product/lastoria-three-cheese-club-sandwich-160-gm-19-19368116", img: "https://i.ibb.co/zWq9CCtt/removebg-preview.png" },
            { id: 4, nameAr: "حلوم كلوب ساندوتش", nameEn: "Halloumi Club Sandwich", weight: "160 جم", price: "9.95 ر.س", link: "https://ananinja.com/sa/ar/product/lastoria-halloumi-club-sandwich-160-gm-19-19368125", img: "https://i.ibb.co/zHWyPnLc/removebg-preview.png" },
            { id: 5, nameAr: "ساندوتش تركي (ديك رومي)", nameEn: "Turkey Sandwich", weight: "خبز الفينا 185 جم", price: "13.95 ر.س", link: "https://ananinja.com/sa/ar/product/lastoria-turkey-sandwich-vienna-bread-185-gm-19-19368112", img: "https://i.ibb.co/b59jMm5D/200-removebg-preview.png" },
            { id: 6, nameAr: "ساندوتش تونة بالحبوب", nameEn: "Tuna Cereal Sandwich", weight: "خبز الشيباتا الحبوب 195 جم", price: "13.95 ر.س", link: "https://ananinja.com/sa/ar/product/lastoria-tuna-sandwich-in-ciabatta-bread-195-gm-19-19368105", img: "https://i.ibb.co/m3ycQvZ/195-removebg-preview.png" },
            { id: 7, nameAr: "ساندوتش تونة", nameEn: "Tuna Club Sandwich", weight: "160 جم", price: "9.95 ر.س", link: "https://ananinja.com/sa/ar/product/lastoria-tuna-club-sandwich-160-gm-19-19368118", img: "https://i.ibb.co/tp82xfx9/removebg-preview.png" },
            { id: 8, nameAr: "ساندوتش حلوم", nameEn: "Halloumi Ciabatta", weight: "خبز الشيباتا الحبوب 195 جم", price: "13.95 ر.س", link: "https://ananinja.com/sa/ar/product/lastoria-halloumi-sandwich-in-ciabatta-bread-195-gm-19-19368104", img: "https://i.ibb.co/CpHXQV37/195-removebg-preview.png" },
            { id: 9, nameAr: "ساندوتش دجاج بيستو", nameEn: "Pesto Chicken Vienna", weight: "خبز الفينا 185 جم", price: "13.95 ر.س", link: "https://ananinja.com/sa/ar/product/lastoria-pesto-chicken-sandwich-vienna-bread-185-gm-19-19368107", img: "https://i.ibb.co/SwmWgrh4/200-removebg-preview.png" },
            { id: 10, nameAr: "ساندوتش دجاج فاهيتا", nameEn: "Fajita Chicken Vienna", weight: "خبز الفينا 185 جم", price: "13.95 ر.س", link: "https://ananinja.com/sa/ar/product/lastoria-fajita-sandwich-viena-bread-185-gm-19-19368124", img: "https://i.ibb.co/SwmWgrh4/200-removebg-preview.png" },
            { id: 11, nameAr: "ساندوتش بريتزل حلوم", nameEn: "Halloumi Pretzel Sandwich", weight: "بريتزل شهي", price: "13.95 ر.س", link: "https://ananinja.com/sa/ar/product/lastoria-halloumi-in-pretzel-bread-19-19368111", img: "https://i.ibb.co/5h1dhyKH/removebg-preview.png" },
            { id: 12, nameAr: "سلطة سيزر", nameEn: "Caesar Salad", weight: "طازجة وصحية", price: "15.95 ر.س", link: "https://ananinja.com/sa/ar/product/lastoria-caesar-salad-19-19368119", img: "https://i.ibb.co/21J9RgZS/removebg-preview.png" },
            { id: 13, nameAr: "سلطة كينوا", nameEn: "Quinoa Salad", weight: "غنية ومغذية", price: "15.95 ر.س", link: "https://ananinja.com/sa/ar/product/lastoria-quinoa-salad-19-19368114", img: "https://i.ibb.co/2191XPVq/removebg-preview.png" },
            { id: 14, nameAr: "شيباتا ثلاث أجبان", nameEn: "Three Cheese Ciabatta", weight: "خبز الشيباتا الحبوب 195 جم", price: "13.95 ر.س", link: "https://ananinja.com/sa/ar/product/lastoria-three-cheese-sandwich-in-ciabatta-bread-195g-19-19368115", img: "https://i.ibb.co/8nBrBzHr/removebg-preview.png" },
            { id: 15, nameAr: "كرواسون زعتر", nameEn: "Zaatar Croissant", weight: "95 جم", price: "5.95 ر.س", link: "https://ananinja.com/sa/ar/product/lastoria-zaatar-croissant-95-gm-19-19368108", img: "https://i.ibb.co/JwSBLhdn/95-removebg-preview.png" },
            { id: 16, nameAr: "كرواسون سادة", nameEn: "Plain Croissant", weight: "95 جم", price: "5.95 ر.س", link: "https://ananinja.com/sa/ar/product/lastoria-plain-croissant-95-gm-19-19368120", img: "https://i.ibb.co/gMsmx7Wt/95-removebg-preview.png" },
            { id: 17, nameAr: "كرواسون جبنة صفراء", nameEn: "Yellow Cheese Croissant", weight: "95 جم", price: "5.95 ر.س", link: "https://ananinja.com/sa/ar/product/lastoria-yellow-cheese-croissant-95-gm-19-19368106", img: "https://i.ibb.co/3mTSCj0Q/removebg-preview.png" },
            { id: 18, nameAr: "كرواسون جبنة بيضاء", nameEn: "White Cheese Croissant", weight: "95 جم", price: "5.95 ر.س", link: "https://ananinja.com/sa/ar/product/lastoria-white-cheese-croissant-95-gm-1-19368110", img: "https://i.ibb.co/SX71QqYY/95-removebg-preview.png" },
            { id: 19, nameAr: "كوكيز شوكولاتة", nameEn: "Chocolate Cookies", weight: "غني بالشوكولاتة", price: "6.95 ر.س", link: "https://ananinja.com/sa/ar/product/lastoria-chocolate-cookies-19-19368109", img: "https://i.ibb.co/NgVw1yry/removebg-preview.png" },
            { id: 20, nameAr: "كوكيز فانيليا", nameEn: "Vanilla Cookies", weight: "هش ولذيذ", price: "6.95 ر.س", link: "https://ananinja.com/sa/ar/product/lastoria-vanilla-cookies-19-19368113", img: "https://i.ibb.co/Z6Mrvfsj/removebg-preview.png" },
            { id: 21, nameAr: "مافن شوكولاته", nameEn: "Chocolate Muffin", weight: "110 جم", price: "6.95 ر.س", link: "https://ananinja.com/sa/ar/product/lastoria-chocolate-muffin-110-gm-1-19368123", img: "https://i.ibb.co/d4Br4L7n/110-removebg-preview.png" },
            { id: 22, nameAr: "مافن فانيليا", nameEn: "Vanilla Muffin", weight: "110 جم", price: "6.95 ر.س", link: "https://ananinja.com/sa/ar/product/lastoria-vanilla-muffin-110g-19-19368117", img: "https://i.ibb.co/Xny8KFV/110-removebg-preview.png" }
        ];

        // ==================================================================
        // 1. MAIN WEBSITE LOGIC
        // ==================================================================
        document.addEventListener('DOMContentLoaded', () => {
            const publicGrid = document.getElementById('publicProductGrid');
            if(publicGrid) {
                publicGrid.innerHTML = allProducts.map(p => `
                    <div class="product-card fade-in-on-scroll">
                        <img src="${p.img}" alt="${p.nameAr}" class="product-image">
                        <div class="product-info">
                            <h3 class="product-name">${p.nameAr}</h3>
                            <p class="product-weight">${p.weight}</p>
                            <div class="product-price">${p.price}</div>
                        </div>
                        <div class="product-order-options">
                            <a href="${p.link}" target="_blank" class="app-link ninja"><img src="https://i.ibb.co/G4fMtQFc/Ninja-Logo-removebg-preview.png"> <span>نينجا</span></a>
                            <a href="#" class="app-link soon"><img src="https://i.ibb.co/0RCrz1tS/Hungerstation-logo-removebg-preview.png"> <span>هنقرستيشن</span></a>
                            <a href="#" class="app-link soon"><img src="https://i.ibb.co/qM4Mf662/Jahez-Logo-removebg-preview.png"> <span>جاهز</span></a>
                            <a href="#" class="app-link soon"><img src="https://i.ibb.co/q35SQGdW/Keeta-Logo-removebg-preview.png"> <span>كيتا</span></a>
                        </div>
                    </div>
                `).join('');
            }

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('reveal'); });
            }, { threshold: 0.1 });
            document.querySelectorAll('.fade-in-on-scroll').forEach(el => observer.observe(el));
            
            const navbar = document.querySelector('.navbar');
            const backToTop = document.getElementById('back-to-top');
            window.addEventListener('scroll', () => {
                navbar.classList.toggle('scrolled', window.scrollY > 50);
                backToTop.classList.toggle('show', window.scrollY > 300);
            });
            backToTop.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
        });

        function openSupplierModal() { document.getElementById('supplierModal').classList.add('active'); }
        function closeSupplierModal() { document.getElementById('supplierModal').classList.remove('active'); }

        // ==================================================================
        // 2. PORTAL LOGIC
        // ==================================================================
        
        let pCart = {};
        let pLang = 'ar';
        let pInitialized = false;

        function togglePortal(show) {
            const mainSite = document.getElementById('main-website-wrapper');
            const portalSite = document.getElementById('portal-container');
            const adminView = document.getElementById('admin-view');
            adminView.classList.remove('active-view');
            if(show) {
                mainSite.style.display = 'none';
                portalSite.classList.add('active-view');
                window.scrollTo(0,0);
                if(!pInitialized) { pRender(''); pInitialized = true; }
            } else {
                portalSite.classList.remove('active-view');
                mainSite.style.display = 'block';
                window.scrollTo(0,0);
            }
        }
        
        function pToggleLang() {
            pLang = pLang === 'ar' ? 'en' : 'ar';
            document.getElementById('pLangBtn').innerText = pLang === 'ar' ? 'English' : 'عربي';
            document.getElementById('pSearchInp').placeholder = pLang === 'ar' ? 'ابحث عن صنف...' : 'Search items...';
            document.getElementById('txtTotalQty').innerText = pLang === 'ar' ? 'إجمالي الكمية' : 'Total Qty';
            document.getElementById('txtCheckout').innerText = pLang === 'ar' ? 'متابعة الطلب' : 'Checkout';
            document.getElementById('txtModalTitle').innerText = pLang === 'ar' ? 'بيانات طلب التوريد' : 'Order Details';
            document.getElementById('txtSendBtn').innerText = pLang === 'ar' ? 'إرسال الطلب' : 'Submit Order';
            pRender(document.getElementById('pSearchInp').value);
        }

        function pRender(filter = '') {
            const grid = document.getElementById('pGrid');
            grid.innerHTML = '';
            let hasRes = false;
            const txt = filter.toLowerCase();

            allProducts.forEach(p => {
                const name = pLang === 'ar' ? p.nameAr : p.nameEn;
                if(name.toLowerCase().includes(txt)) {
                    hasRes = true;
                    const isActive = pCart[p.id] > 0;
                    const qtyVal = pCart[p.id] || '';
                    const placeholder = pLang === 'ar' ? 'الكمية' : 'Qty';

                    const card = document.createElement('div');
                    card.className = `p-card ${isActive ? 'p-active' : ''}`;
                    card.innerHTML = `
                        <div class="p-img-box"><img src="${p.img}" alt="Product"></div>
                        <div class="p-details">
                            <div class="p-title">${name}</div>
                            <input type="number" min="0" class="p-qty-box" value="${qtyVal}" placeholder="${placeholder}" oninput="pUpdateQtyDirect(${p.id}, this.value)" onfocus="this.select()">
                        </div>`;
                    grid.appendChild(card);
                }
            });
            document.getElementById('pNoResults').style.display = hasRes ? 'none' : 'block';
            pUpdBar();
        }

        // --- KEY FIX FOR MOBILE INPUT ---
        // Instead of re-rendering the whole grid (which kills focus), we just update the total bar.
        window.pUpdateQtyDirect = (id, val) => {
            let v = parseInt(val);
            if(isNaN(v) || v <= 0) delete pCart[id]; else pCart[id] = v;
            
            // Only update the totals bar, do NOT re-render the grid
            pUpdBar();
        };

        function pUpdBar() {
            const t = Object.values(pCart).reduce((a,b)=>a+b,0);
            document.getElementById('pTotalQty').innerText = t;
            const bar = document.getElementById('pFloatBar');
            t > 0 ? bar.classList.add('visible') : bar.classList.remove('visible');
        }
        
        window.pOpenModal = () => document.getElementById('pModal').classList.add('active');
        window.pCloseModal = () => document.getElementById('pModal').classList.remove('active');
        window.pSubmitOrder = () => {
            const name = document.getElementById('pClientName').value.trim();
            const code = document.getElementById('pClientCode').value.trim();
            const notes = document.getElementById('pNotes').value;
            if(!name || !code) { alert('الاسم والكود مطلوبين'); return; }

            const btn = document.querySelector('.p-send-btn');
            btn.innerText = "جاري الإرسال...";
            btn.disabled = true;

            let items = [];
            let total = 0;
            allProducts.forEach(p => {
                if(pCart[p.id]) { items.push({ name: p.nameAr, qty: pCart[p.id] }); total += pCart[p.id]; }
            });

            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, code, notes, items, total })
            }).then(() => {
                alert('تم إرسال الطلب بنجاح');
                pCart = {}; pRender(); pCloseModal();
                btn.innerText = "إرسال الطلب"; btn.disabled = false;
            }).catch(() => {
                alert('خطأ في الاتصال'); btn.innerText = "إرسال الطلب"; btn.disabled = false;
            });
        }
        // Keep searching functional
        document.getElementById('pSearchInp').addEventListener('input', (e) => pRender(e.target.value));


        // ==================================================================
        // 3. ADMIN PANEL FUNCTIONS
        // ==================================================================
        
        let allOrdersCache = []; 
        
        function promptAdminLogin() {
            let pass = prompt("أدخل كلمة مرور المشرف:");
            if(pass === "20002000") toggleAdminView(true);
        }

        function toggleAdminView(show) {
            const portalSite = document.getElementById('portal-container');
            const adminView = document.getElementById('admin-view');
            if(show) {
                portalSite.classList.remove('active-view');
                adminView.classList.add('active-view');
                fetchOrders();
            } else {
                adminView.classList.remove('active-view');
                portalSite.classList.add('active-view');
            }
        }

        function fetchOrders() {
            const container = document.getElementById('admin-orders-grid');
            
            container.innerHTML = '<div style="text-align:center; padding:50px;">جاري تحميل الطلبات <i class="fas fa-spinner fa-spin"></i></div>';
            
            fetch(GOOGLE_SCRIPT_URL)
            .then(res => res.json())
            .then(data => {
                allOrdersCache = data; 
                renderAdminPanel(data);
            })
            .catch(err => {
                container.innerHTML = '<div style="text-align:center; color:red;">فشل جلب البيانات.</div>';
            });
        }

        function renderAdminPanel(orders) {
            const container = document.getElementById('admin-orders-grid');
            const archiveGrid = document.getElementById('admin-archive-grid');
            const searchTerm = document.getElementById('adminSearch').value.toLowerCase();
            
            const archivedIDs = JSON.parse(localStorage.getItem('archivedOrders') || '[]');

            let activeHtml = '';
            let archiveHtml = '';

            orders.forEach((order) => {
                const uniqueId = order.code + '_' + order.date;
                const isArchived = archivedIDs.includes(uniqueId);
                
                const searchStr = (order.client + ' ' + order.code).toLowerCase();
                if(searchTerm && !searchStr.includes(searchTerm)) return;

                let dateStr = 'غير محدد';
                if(order.date) {
                    const d = new Date(order.date);
                    // English Date Format
                    dateStr = d.toLocaleDateString('en-GB') + ' ' + d.toLocaleTimeString('en-GB', {hour: '2-digit', minute:'2-digit'});
                }

                let itemsHtml = '';
                let totalQuantity = 0; 

                if(order.items) {
                    const rawItems = order.items.split(' | '); 
                    
                    rawItems.forEach(i => {
                        let name = i;
                        let qty = '?';
                        
                        let parts = i.match(/(.+)\s\((\d+)\)/);
                        if(parts) {
                            name = parts[1];
                            qty = parts[2];
                            totalQuantity += parseInt(qty) || 0;
                        } else {
                            name = i;
                        }

                        itemsHtml += `
                            <tr>
                                <td>${name}</td>
                                <td style="text-align:center; width:60px;">
                                    <span class="admin-qty-badge">${qty}</span>
                                </td>
                            </tr>
                        `;
                    });
                }

                const cardHtml = `
                    <div class="admin-card">
                        <div class="admin-card-header">
                            <div>
                                <div class="admin-info-row"><i class="fas fa-calendar-alt"></i> ${dateStr}</div>
                                <div class="admin-client"><i class="fas fa-user-tie" style="color:#B28451; margin-left:5px;"></i> ${order.client}</div>
                            </div>
                            <span class="admin-code-badge"><i class="fas fa-hashtag"></i> ${order.code}</span>
                        </div>
                        
                        <table class="admin-products-table">
                            ${itemsHtml}
                        </table>
                        
                        <div class="admin-total-row">
                            إجمالي الكمية: ${totalQuantity}
                        </div>

                        ${order.notes ? `
                        <div class="admin-notes">
                            <i class="fas fa-sticky-note"></i> 
                            <div><strong>ملاحظات:</strong> ${order.notes}</div>
                        </div>` : ''}

                        <div class="admin-footer">
                            ${isArchived 
                                ? `<div class="archive-status"><i class="fas fa-check-circle"></i> تم إصدار الفاتورة</div>`
                                : `<button class="btn-invoice" onclick="toggleArchive('${uniqueId}')"><i class="fas fa-check"></i> تم إصدار الفاتورة</button>`
                            }
                        </div>
                    </div>
                `;

                if(isArchived) archiveHtml += cardHtml;
                else activeHtml += cardHtml;
            });

            container.innerHTML = activeHtml || '<div style="text-align:center; color:#999; padding:20px;">لا توجد طلبات جديدة</div>';
            archiveGrid.innerHTML = archiveHtml || '<div style="text-align:center; color:#999; padding:20px;">الأرشيف فارغ</div>';
        }

        function toggleArchive(id) {
            let archivedIDs = JSON.parse(localStorage.getItem('archivedOrders') || '[]');
            if(!archivedIDs.includes(id)) {
                if(confirm("هل أنت متأكد من إصدار الفاتورة وأرشفة الطلب؟")) {
                    archivedIDs.push(id);
                    localStorage.setItem('archivedOrders', JSON.stringify(archivedIDs));
                    renderAdminPanel(allOrdersCache);
                }
            }
        }

        function filterOrders() {
            renderAdminPanel(allOrdersCache);
        }

        function openArchiveModal() {
            document.getElementById('admin-archive-modal').style.display = 'flex';
        }
        function closeArchiveModal() {
            document.getElementById('admin-archive-modal').style.display = 'none';
        }

        // Close Modal with ESC
        document.addEventListener('keydown', function(event) {
            if (event.key === "Escape") {
                closeArchiveModal();
            }
        });

    </script>

</body>
</html>
